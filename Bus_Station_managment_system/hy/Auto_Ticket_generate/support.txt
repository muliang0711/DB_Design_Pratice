CREATE SEQUENCE TICKET_ID_SEQ START WITH 1 NOCACHE NOCYCLE;


BEGIN
  EXECUTE IMMEDIATE 'CREATE SEQUENCE SEQ_TICKET_ID START WITH 1 INCREMENT BY 1 NOCACHE';
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE != -955 THEN RAISE; END IF; -- 已存在则忽略
END;
/


CREATE OR REPLACE FUNCTION FN_NEXT_TICKET_ID RETURN VARCHAR2 IS
  v_next NUMBER;
BEGIN
  SELECT SEQ_TICKET_ID.NEXTVAL INTO v_next FROM dual;
  RETURN 'T' || LPAD(v_next, 11, '0'); 
END;
/